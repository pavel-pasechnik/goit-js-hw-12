{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["'use strict';\n\n// Описаний у документації\nimport iziToast from 'izitoast';\n// Додатковий імпорт стилів\nimport 'izitoast/dist/css/iziToast.min.css';\n// Описаний у документації\nimport SimpleLightbox from 'simplelightbox';\n// Додатковий імпорт стилів\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n// Підключення завантажувача\nimport axios from 'axios';\n\nconst api = axios.create({\n  baseURL: 'https://pixabay.com/api/',\n  params: {\n    key: '41487030-c0d4f2e8fae3a5e9414bad560',\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: 'true',\n  },\n});\n\nconst form = document.querySelector('.search-form');\nconst ul = document.querySelector('.images-list');\nconst loadMoreBtn = document.querySelector('.load_more_btn');\nconst input = document.querySelector('.search-input');\nconst divGallery = document.querySelector('.gallery');\n// Ініціалізація SimpleLightbox один раз поза обробником подій\nconst lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: '250',\n});\n\n// Створення нового елементу для завантажувача\nconst loaderElement = document.createElement('span');\nloaderElement.className = 'loader is-hidden';\n\n// Додавання завантажувача до списку\ndivGallery.append(loaderElement);\nconst loaderClass = document.querySelector('.loader');\n\n// Функція виведення зображення на сторінку\nfunction renderImages(images = []) {\n  const insertImages = images.reduce(\n    (html, img) =>\n      html +\n      `\n      <li class=\"images-item\">\n        <a class=\"images-link\" href=\"${img.largeImageURL}\"><img class=\"images\" data-source=\"${img.largeImageURL}\" alt=\"${img.tags}\" src=\"${img.webformatURL}\" width=\"360\" height=\"200\"></a>\n        <div class=\"description\">\n        <div>\n          <p><b>Likes</b></p>\n          <p>${img.likes}</p>\n        </div>\n        <div>\n          <p><b>Views</b></p>\n          <p>${img.views}</p>\n        </div>\n        <div>\n          <p><b>Comments</b></p>\n          <p>${img.comments}</p>\n        </div>\n        <div>\n          <p><b>Downloads</b></p>\n          <p>${img.downloads}</p>\n        </div>\n        </div>\n      </li>\n        `,\n    ''\n  );\n\n  ul.insertAdjacentHTML('beforeend', insertImages);\n  // Виклик методу для оновлення галереї\n  lightbox.refresh();\n}\n\n// Виклик повідомлення з помилкою\nfunction errorAlert() {\n  iziToast.show({\n    title: '',\n    message:\n      'Sorry, there are no images matching your search query. Please try again!',\n    messageColor: '#FFFFFF',\n    backgroundColor: '#EF4040',\n    color: '#B51B1B',\n    iconUrl: './bi_x-octagon.svg',\n    iconColor: '#FAFAFB',\n    position: 'topRight',\n  });\n}\n\n// Виклик повідомлення про кінець колекції\nfunction finishAlert() {\n  iziToast.info({\n    title: '',\n    message: `We're sorry, but you've reached the end of search results.`,\n    position: 'topRight',\n  });\n}\n\n// ============= Пагінація ============ //\n\n// Функція створення запиту\nconst getImages = async params => {\n  try {\n    const response = await api.get('', { params });\n    return response.data;\n  } catch (error) {\n    errorAlert();\n  }\n};\n\n// Функція для створення параметрів запиту\nconst createGetImagesRequest = q => {\n  let page = 1;\n  let isLastPage = false;\n  const per_page = 40;\n\n  return async () => {\n    try {\n      // Виходимо, якщо остання сторінка\n      if (isLastPage) return [];\n      // Робимо запит на першу сторінку\n      const { hits, totalHits } = await getImages({ page, per_page, q });\n\n      // Перевіряємо на наявність зображень згідно запиту\n      if (hits.length === 0) {\n        throw new Error();\n      }\n\n      // Відображаємо кнопку Load More\n      loadMoreBtn.classList.remove('is-hidden');\n\n      // Вираховуємо останню сторінку\n      if (page >= Math.ceil(totalHits / per_page)) {\n        isLastPage = true;\n        // Приховуємо кнопку Load More\n        loadMoreBtn.classList.add('is-hidden');\n        finishAlert();\n      }\n      // Додаємо сторінки для Load More\n      page++;\n      // Повертаємо додану сторінку\n      return hits;\n    } catch (error) {\n      errorAlert();\n    }\n  };\n};\n\n// ============= /Пагінація ============ //\n\n// Для замикання функції виведення зображень\nlet doFetch = null;\n\nform.addEventListener('submit', async event => {\n  event.preventDefault();\n\n  // Видаляємо слухача Load More, якщо він вже викликався до нового пошуку\n  if (doFetch != null) {\n    loadMoreBtn.removeEventListener('click', doFetch);\n    // Приховуємо кнопку Load More\n    loadMoreBtn.classList.add('is-hidden');\n  }\n\n  // Беремо данні з поля введення форми\n  const data = new FormData(event.currentTarget);\n  const query = data.get('query');\n  // Чистимо сторінку і поле введення від попереднього запиту\n  ul.innerHTML = '';\n  input.value = '';\n\n  // Викликаємо запит\n  const fetchImages = createGetImagesRequest(query);\n\n  // Функція виведення зображень\n  doFetch = async () => {\n    // Приховуємо кнопку Load More\n    loadMoreBtn.classList.add('is-hidden');\n    // Відображення завантажувача\n    loaderClass.classList.remove('is-hidden');\n    // Чекаємо на зображення\n    const images = await fetchImages();\n    // Приховання завантажувача після отримання результатів\n    loaderClass.classList.add('is-hidden');\n\n    // Відмальовуємо зображення\n    renderImages(images);\n\n    // TODO заморочка з прокруткою\n    // Отримати посилання на елемент\n    const elementLi = document.querySelector('.images-item');\n\n    // Отримати об'єкт DOMRect\n    const rect = elementLi.getBoundingClientRect();\n\n    // Отримати розміри та позицію\n    const height = (rect.height + 24) * 2;\n\n    // Гортаємо сторінку вниз\n    window.scrollBy({\n      top: height,\n      left: 0,\n      behavior: 'smooth',\n    });\n    // TODO/\n  };\n\n  await doFetch();\n\n  // Додаємо слухача Load More з повторним викликом функції виведення зображень\n  loadMoreBtn.addEventListener('click', doFetch);\n});\n"],"names":["api","axios","form","ul","loadMoreBtn","input","divGallery","lightbox","SimpleLightbox","loaderElement","loaderClass","renderImages","images","insertImages","html","img","errorAlert","iziToast","finishAlert","getImages","params","createGetImagesRequest","q","page","isLastPage","per_page","hits","totalHits","doFetch","event","query","fetchImages","height"],"mappings":"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"}